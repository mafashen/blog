
```
graph TD
A(start)-->B[DNS获取目标IP地址]
B-->B1[本机DNS缓存]
B-->B2[hosts文件]
B-->B3[域名服务器]
B2-->C
B3-->C
B1-->C[组装HTTP请求头]
C--加上端口号-->D[TCP头]
D--加上ip地址-->E[IP头]
E--加上自己和网关的mac地址 ARP-->F[MAC头]
F-->G[路由器]

subgraph loop
G--路由表 路由协议-->H[目标地址局域网路由器]
end

H-->I[目标mac地址]
I-->J[到达目标机器网卡]
J-->K[对比mac地址]
K-->L[对比ip地址]
L-->M[对比端口号]
M-->N[应用服务处理]

subgraph 
N-->O[返回响应]
end
```

---

#### 只要是在网络上跑的包，都是完整的。可以有下层没有上层，绝对不可能有上层没有下层。

---

#### 目标地址是一个网段的，会使用ARP获取目标MAC地址；否则，就会把包发送到网关，如果配置了网关，会获取网关Mac地址，然后发送过去，如果没有配置网关，发送不出去

#### 网关必须是和当前网络至少一个网卡在同一网段

---

##### 为什么有了IP地址还需要Mac地址？
- IP协议是上层协议，需要依赖数据链路层协议
- 对于局域网，一个局域网使用同一个公网IP，只是用IP地址并不能定位到具体的机器，IP地址类似于地址，Mac地址类似于门牌号，需要门牌号才能定位到具体的机器
- MAC 地址是有一定定位功能的，只不过范围非常有限(局域网)
- MAC 地址更像是身份证，是一个唯一的标识。它的唯一性设计是为了组网的时候，不同的网卡放在一个 网络里面的时候，可以不用担心冲突。从硬件角度，保证不同的网卡有不同的标识
